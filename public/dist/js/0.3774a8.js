(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{18:function(n,t,a){"use strict";var e=a(1),r=a.n(e);function s(n,t,a,e,r,s,o){try{var i=n[s](o),c=i.value}catch(n){return void a(n)}i.done?t(c):Promise.resolve(c).then(e,r)}var o={data:function(){return{myInterval:null,chatrooms:[]}},mounted:function(){var n=this;this.$store.getters["auth/user"]&&(this.init(),this.myInterval=setInterval((function(){n.init()}),5e3))},beforeDestroy:function(){},methods:{init:function(){var n,t=this;return(n=r.a.mark((function n(){var a,e;return r.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,axios.post("/api/get_chatroom_list");case 3:a=n.sent,e=a.data,t.chatrooms=e.chatrooms,n.next=11;break;case 8:n.prev=8,n.t0=n.catch(0),clearInterval(t.myInterval);case 11:case"end":return n.stop()}}),n,null,[[0,8]])})),function(){var t=this,a=arguments;return new Promise((function(e,r){var o=n.apply(t,a);function i(n){s(o,e,r,i,c,"next",n)}function c(n){s(o,e,r,i,c,"throw",n)}i(void 0)}))})()},isShowBadge:function(){var n=this,t=!1;return this.chatrooms.forEach((function(a){a.messages.forEach((function(a){a.read_flags.split("  ").includes(String(n.$store.getters["auth/user"].id))||(t=!0)}))})),t}}},i=(a(341),a(4)),c=Object(i.a)(o,(function(){var n=this,t=n.$createElement,a=n._self._c||t;return a("div",{staticClass:"bottom_tab"},[a("router-link",{attrs:{to:{name:"search"}}},[a("img",{attrs:{src:"/asset/icons/magnifying-glass-solid.svg"}}),n._v(" "),a("span",[n._v("条件で探す")])]),n._v(" "),a("router-link",{attrs:{to:{name:"message"}}},[a("img",{attrs:{src:"/asset/icons/comment-solid.svg"}}),n._v(" "),a("span",[n._v("メッセージ")]),n._v(" "),n.isShowBadge()?a("span",{staticClass:"badge"}):n._e()]),n._v(" "),a("router-link",{attrs:{to:{name:"mypage"}}},[a("img",{attrs:{src:"/asset/icons/user-gear-solid.svg"}}),n._v(" "),a("span",[n._v("マイページ")])])],1)}),[],!1,null,"1b804918",null);t.a=c.exports},230:function(n,t,a){var e=a(342);"string"==typeof e&&(e=[[n.i,e,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};a(8)(e,r);e.locals&&(n.exports=e.locals)},251:function(n,t,a){var e=a(384);"string"==typeof e&&(e=[[n.i,e,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};a(8)(e,r);e.locals&&(n.exports=e.locals)},33:function(n,t,a){"use strict";a.r(t);var e=a(1),r=a.n(e),s=a(18),o=a(2),i=a.n(o);function c(n,t,a,e,r,s,o){try{var i=n[s](o),c=i.value}catch(n){return void a(n)}i.done?t(c):Promise.resolve(c).then(e,r)}var d={components:{BottomTab:s.a},data:function(){return{chatrooms:[],unsubscribe:void 0,myInterval:null}},mounted:function(){var n=this;this.init(),this.myInterval=setInterval((function(){n.init()}),5e3)},beforeDestroy:function(){clearInterval(this.myInterval)},methods:{toDetail:function(n){this.$router.push({name:"message.detail",query:{id:n.id}})},init:function(){var n,t=this;return(n=r.a.mark((function n(){var a,e;return r.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,axios.post("/api/get_chatroom_list");case 3:a=n.sent,e=a.data,t.chatrooms=e.chatrooms,t.chatrooms.sort((function(n,t){return(t.messages.length>0?new Date(t.messages[0].created_at):new Date(t.created_at))-(n.messages.length>0?new Date(n.messages[0].created_at):new Date(n.created_at))})),n.next=11;break;case 9:n.prev=9,n.t0=n.catch(0);case 11:case"end":return n.stop()}}),n,null,[[0,9]])})),function(){var t=this,a=arguments;return new Promise((function(e,r){var s=n.apply(t,a);function o(n){c(s,e,r,o,i,"next",n)}function i(n){c(s,e,r,o,i,"throw",n)}o(void 0)}))})()},calcBadgeCount:function(n){var t=this,a=n.messages,e=0;return a.forEach((function(n){n.read_flags.split("  ").includes(String(t.$store.getters["auth/user"].id))||(e+=1)})),e},isShowBadge:function(n){var t=this,a=n.messages,e=!1;return a.forEach((function(n){n.read_flags.split("  ").includes(String(t.$store.getters["auth/user"].id))||(e=!0)})),e},targetUserAvatar:function(n){var t=this,a=n.participants.find((function(n){return n.user_id!=t.$store.getters["auth/user"].id}));return a.user.avatars?a.user.avatars[0].avatar_url:""},targetUserName:function(n){var t=this;return n.participants.find((function(n){return n.user_id!=t.$store.getters["auth/user"].id})).user.profile.nickname},calcLastMessage:function(n){return n.messages.length>0?n.messages[0].content:"新しいチャットです。"},calcLastMessageTime:function(n){return n.messages.length>0?"("+i()(n.messages[0].created_at).format("YYYY/MM/DD HH:mm")+")":""}}},m=(a(383),a(4)),l=Object(m.a)(d,(function(){var n=this,t=n.$createElement,a=n._self._c||t;return a("div",{staticClass:"message__container"},[a("div",{staticClass:"inner"},[a("h2",[n._v("メッセージ一覧")]),n._v(" "),a("div",{staticClass:"chatroom__list"},n._l(n.chatrooms,(function(t,e){return a("div",{key:e,staticClass:"chatroom__item",on:{click:function(a){return n.toDetail(t)}}},[n.isShowBadge(t)?a("span",{staticClass:"badge"},[n._v(n._s(n.calcBadgeCount(t)))]):n._e(),n._v(" "),a("div",{staticClass:"left"},[a("p",{staticClass:"avatar"},[a("img",{attrs:{src:n.targetUserAvatar(t)}})]),n._v(" "),a("p",{staticClass:"name"},[n._v(n._s(n.targetUserName(t)))])]),n._v(" "),a("p",{staticClass:"last_message"},[n._v(n._s(n.calcLastMessage(t))),a("br"),a("span",{staticClass:"message_at"},[n._v(n._s(n.calcLastMessageTime(t)))])])])})),0)]),n._v(" "),a("BottomTab")],1)}),[],!1,null,"d090dff0",null);t.default=l.exports},341:function(n,t,a){"use strict";a(230)},342:function(n,t,a){(n.exports=a(7)(!1)).push([n.i,".bottom_tab[data-v-1b804918] {\n  height: 60px;\n  position: fixed;\n  bottom: 0;\n  left: 0;\n  width: 100%;\n  background-color: #fff;\n  z-index: 199;\n  box-shadow: 6px 3px 0 rgba(0, 0, 0, 0.16);\n  display: none;\n  padding-left: 5px;\n  padding-right: 5vw;\n}\n@media screen and (max-width: 768px) {\n.bottom_tab[data-v-1b804918] {\n    display: flex;\n}\n}\n.bottom_tab a[data-v-1b804918] {\n  flex: 1;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  flex-direction: column;\n  color: #333;\n  position: relative;\n}\n.bottom_tab a img[data-v-1b804918] {\n  height: 20px;\n  margin-bottom: 2px;\n}\n.bottom_tab a span[data-v-1b804918] {\n  font-size: 14px;\n}\n.bottom_tab a .badge[data-v-1b804918] {\n  position: absolute;\n  width: 3vw;\n  height: 3vw;\n  border-radius: 1.5vw;\n  background-color: #ff0000;\n  right: 1vw;\n  top: 1vw;\n}",""])},383:function(n,t,a){"use strict";a(251)},384:function(n,t,a){(n.exports=a(7)(!1)).push([n.i,'.message__container[data-v-d090dff0] {\n  width: 800px;\n  margin-left: auto;\n  margin-right: auto;\n  padding-top: 50px;\n  padding-bottom: 50px;\n}\n@media screen and (max-width: 768px) {\n.message__container[data-v-d090dff0] {\n    width: 90vw;\n    padding-top: 4vw;\n    padding-bottom: 60px;\n}\n}\n.message__container .inner[data-v-d090dff0] {\n  position: relative;\n}\n.message__container .inner h2[data-v-d090dff0] {\n  font-size: 26px;\n  text-align: center;\n  color: var(--main-color);\n  margin-bottom: 60px;\n  position: relative;\n}\n@media screen and (max-width: 768px) {\n.message__container .inner h2[data-v-d090dff0] {\n    font-size: 5vw;\n    margin-bottom: 10vw;\n}\n}\n.message__container .inner h2[data-v-d090dff0]:before {\n  content: "";\n  position: absolute;\n  left: 50%;\n  bottom: -20px;\n  transform: translate(-50%, 0);\n  width: 50px;\n  height: 1px;\n  background-color: var(--main-color);\n}\n@media screen and (max-width: 768px) {\n.message__container .inner h2[data-v-d090dff0]:before {\n    bottom: -5vw;\n    width: 20vw;\n}\n}\n.message__container .inner h2.non_border[data-v-d090dff0] {\n  margin-bottom: 40px;\n}\n.message__container .inner h2.non_border[data-v-d090dff0]:before {\n  display: none;\n}\n.message__container .inner .chatroom__list[data-v-d090dff0] {\n  display: flex;\n  flex-wrap: wrap;\n  padding-top: 20px;\n}\n@media screen and (max-width: 768px) {\n.message__container .inner .chatroom__list[data-v-d090dff0] {\n    padding-top: 4vw;\n}\n}\n.message__container .inner .chatroom__list .chatroom__item[data-v-d090dff0] {\n  width: 100%;\n  margin-bottom: 10px;\n  display: flex;\n  align-items: center;\n  padding: 10px;\n  border-radius: 5px;\n  cursor: pointer;\n  border: 1px solid transparent;\n  position: relative;\n}\n.message__container .inner .chatroom__list .chatroom__item .badge[data-v-d090dff0] {\n  position: absolute;\n  left: 50px;\n  top: 5px;\n  color: #fff;\n  height: 20px;\n  padding-left: 4px;\n  padding-right: 4px;\n  border-radius: 10px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  border-radius: 7px;\n  background-color: #ff0000;\n  z-index: 200;\n}\n@media screen and (max-width: 768px) {\n.message__container .inner .chatroom__list .chatroom__item[data-v-d090dff0] {\n    width: 100%;\n    margin-right: 0 !important;\n    margin-bottom: 2vw;\n    padding: 2vw;\n    border-radius: 1.5vw;\n    border: 1px solid var(--bg-color);\n    box-shadow: 0 3px 6px rgba(0, 0, 0, 0.16);\n}\n}\n.message__container .inner .chatroom__list .chatroom__item[data-v-d090dff0]:hover {\n  border: 1px solid var(--bg-color);\n  box-shadow: 0 3px 6px rgba(0, 0, 0, 0.16);\n}\n.message__container .inner .chatroom__list .chatroom__item[data-v-d090dff0]:nth-of-type(2n) {\n  margin-right: 0;\n}\n.message__container .inner .chatroom__list .chatroom__item .left[data-v-d090dff0] {\n  margin-right: 10px;\n  width: 50px;\n  overflow: hidden;\n}\n.message__container .inner .chatroom__list .chatroom__item .avatar[data-v-d090dff0] {\n  width: 50px;\n  height: 50px;\n  position: relative;\n  border-radius: 50%;\n  overflow: hidden;\n}\n.message__container .inner .chatroom__list .chatroom__item .avatar img[data-v-d090dff0] {\n  position: absolute;\n  left: 0;\n  top: 0;\n  width: 100%;\n  height: 100%;\n}\n.message__container .inner .chatroom__list .chatroom__item .name[data-v-d090dff0] {\n  font-size: 12px;\n  text-align: center;\n  margin-top: 4px;\n}\n.message__container .inner .chatroom__list .chatroom__item .last_message[data-v-d090dff0] {\n  font-size: 14px;\n  flex: 1;\n  word-break: break-all;\n  white-space: pre-wrap;\n}\n.message__container .inner .chatroom__list .chatroom__item .last_message .message_at[data-v-d090dff0] {\n  margin-left: 10px;\n  font-size: 12px;\n  color: #777;\n}',""])}}]);