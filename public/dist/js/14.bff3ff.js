(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{18:function(e,t,n){"use strict";var a=n(1),s=n.n(a);function r(e,t,n,a,s,r,i){try{var o=e[r](i),d=o.value}catch(e){return void n(e)}o.done?t(d):Promise.resolve(d).then(a,s)}var i={data:function(){return{myInterval:null,chatrooms:[]}},mounted:function(){var e=this;this.$store.getters["auth/user"]&&(this.init(),this.myInterval=setInterval((function(){e.init()}),5e3))},beforeDestroy:function(){},methods:{init:function(){var e,t=this;return(e=s.a.mark((function e(){var n,a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,axios.post("/api/get_chatroom_list");case 3:n=e.sent,a=n.data,t.chatrooms=a.chatrooms,e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),clearInterval(t.myInterval);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})),function(){var t=this,n=arguments;return new Promise((function(a,s){var i=e.apply(t,n);function o(e){r(i,a,s,o,d,"next",e)}function d(e){r(i,a,s,o,d,"throw",e)}o(void 0)}))})()},isShowBadge:function(){var e=this,t=!1;return this.chatrooms.forEach((function(n){n.messages.forEach((function(n){n.read_flags.split("  ").includes(String(e.$store.getters["auth/user"].id))||(t=!0)}))})),t}}},o=(n(341),n(4)),d=Object(o.a)(i,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"bottom_tab"},[n("router-link",{attrs:{to:{name:"search"}}},[n("img",{attrs:{src:"/asset/icons/magnifying-glass-solid.svg"}}),e._v(" "),n("span",[e._v("条件で探す")])]),e._v(" "),n("router-link",{attrs:{to:{name:"message"}}},[n("img",{attrs:{src:"/asset/icons/comment-solid.svg"}}),e._v(" "),n("span",[e._v("メッセージ")]),e._v(" "),e.isShowBadge()?n("span",{staticClass:"badge"}):e._e()]),e._v(" "),n("router-link",{attrs:{to:{name:"mypage"}}},[n("img",{attrs:{src:"/asset/icons/user-gear-solid.svg"}}),e._v(" "),n("span",[e._v("マイページ")])])],1)}),[],!1,null,"1b804918",null);t.a=d.exports},230:function(e,t,n){var a=n(342);"string"==typeof a&&(a=[[e.i,a,""]]);var s={hmr:!0,transform:void 0,insertInto:void 0};n(8)(a,s);a.locals&&(e.exports=a.locals)},250:function(e,t,n){var a=n(382);"string"==typeof a&&(a=[[e.i,a,""]]);var s={hmr:!0,transform:void 0,insertInto:void 0};n(8)(a,s);a.locals&&(e.exports=a.locals)},341:function(e,t,n){"use strict";n(230)},342:function(e,t,n){(e.exports=n(7)(!1)).push([e.i,".bottom_tab[data-v-1b804918] {\n  height: 60px;\n  position: fixed;\n  bottom: 0;\n  left: 0;\n  width: 100%;\n  background-color: #fff;\n  z-index: 199;\n  box-shadow: 6px 3px 0 rgba(0, 0, 0, 0.16);\n  display: none;\n  padding-left: 5px;\n  padding-right: 5vw;\n}\n@media screen and (max-width: 768px) {\n.bottom_tab[data-v-1b804918] {\n    display: flex;\n}\n}\n.bottom_tab a[data-v-1b804918] {\n  flex: 1;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  flex-direction: column;\n  color: #333;\n  position: relative;\n}\n.bottom_tab a img[data-v-1b804918] {\n  height: 20px;\n  margin-bottom: 2px;\n}\n.bottom_tab a span[data-v-1b804918] {\n  font-size: 14px;\n}\n.bottom_tab a .badge[data-v-1b804918] {\n  position: absolute;\n  width: 3vw;\n  height: 3vw;\n  border-radius: 1.5vw;\n  background-color: #ff0000;\n  right: 1vw;\n  top: 1vw;\n}",""])},381:function(e,t,n){"use strict";n(250)},382:function(e,t,n){(e.exports=n(7)(!1)).push([e.i,".message_detail[data-v-9d337cf6] {\n  position: relative;\n  width: 600px;\n  margin-left: auto;\n  margin-right: auto;\n  padding-top: 30px;\n  padding-bottom: 30px;\n}\n@media screen and (max-width: 768px) {\n.message_detail[data-v-9d337cf6] {\n    width: 90vw;\n    padding-top: 5vw;\n    padding-bottom: 0;\n}\n}\n.message_detail .message_list[data-v-9d337cf6] {\n  height: calc(100vh - 300px);\n  overflow: auto;\n}\n@media screen and (max-width: 768px) {\n.message_detail .message_list[data-v-9d337cf6] {\n    height: calc(100vh - 84vw);\n}\n}\n.message_detail .message__item[data-v-9d337cf6] {\n  width: 100%;\n  display: flex;\n  margin-bottom: 10px;\n}\n@media screen and (max-width: 768px) {\n.message_detail .message__item[data-v-9d337cf6] {\n    margin-bottom: 2vw;\n}\n}\n.message_detail .message__item .avatar[data-v-9d337cf6] {\n  width: 60px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  flex-direction: column;\n  margin-right: 10px;\n}\n@media screen and (max-width: 768px) {\n.message_detail .message__item .avatar[data-v-9d337cf6] {\n    width: 12vw;\n    margin-right: 2vw;\n}\n}\n.message_detail .message__item .avatar.avatar1[data-v-9d337cf6] {\n  margin-right: 0;\n  margin-left: 10px;\n}\n@media screen and (max-width: 768px) {\n.message_detail .message__item .avatar.avatar1[data-v-9d337cf6] {\n    margin-right: 2vw;\n}\n}\n.message_detail .message__item .avatar img[data-v-9d337cf6] {\n  width: 40px;\n  height: 40px;\n  border-radius: 50%;\n  margin-bottom: 6px;\n}\n@media screen and (max-width: 768px) {\n.message_detail .message__item .avatar img[data-v-9d337cf6] {\n    width: 10vw;\n    height: 10vw;\n    margin-bottom: 1vw;\n}\n}\n.message_detail .message__item .avatar .name[data-v-9d337cf6] {\n  font-size: 12px;\n  overflow: hidden;\n  white-space: nowrap;\n  text-overflow: ellipsis;\n  width: 100%;\n}\n@media screen and (max-width: 768px) {\n.message_detail .message__item .avatar .name[data-v-9d337cf6] {\n    font-size: 3vw;\n}\n}\n.message_detail .message__item .message_body[data-v-9d337cf6] {\n  flex: 1;\n}\n.message_detail .message__item .message_body .date[data-v-9d337cf6] {\n  text-align: left;\n  font-size: 12px;\n  color: #777;\n  margin-bottom: 4px;\n}\n.message_detail .message__item .message_body .date.self[data-v-9d337cf6] {\n  text-align: right;\n}\n@media screen and (max-width: 768px) {\n.message_detail .message__item .message_body .date[data-v-9d337cf6] {\n    font-size: 3vw;\n    margin-bottom: 1vw;\n}\n}\n.message_detail .message__item .message_body .content[data-v-9d337cf6] {\n  font-size: 14px;\n  border-radius: 10px;\n  padding: 10px;\n  background-color: var(--main-color);\n  width: -webkit-fit-content;\n  width: -moz-fit-content;\n  width: fit-content;\n  position: relative;\n  word-break: break-all;\n  white-space: pre-wrap;\n}\n.message_detail .message__item .message_body .content.self[data-v-9d337cf6] {\n  margin-left: auto;\n}\n@media screen and (max-width: 768px) {\n.message_detail .message__item .message_body .content[data-v-9d337cf6] {\n    font-size: 3.5vw;\n    border-radius: 2vw;\n    padding: 2vw;\n}\n}\n.message_detail .message__item .message_body .content .mask[data-v-9d337cf6] {\n  position: absolute;\n  left: 0;\n  top: 0;\n  width: 100%;\n  height: 100%;\n  z-index: 100;\n  border-radius: 10px;\n  background-color: var(--main-color);\n  filter: blur(0.4rem);\n}\n.message_detail .message__input_form[data-v-9d337cf6] {\n  position: fixed;\n  bottom: 70px;\n  width: 600px;\n  left: 50%;\n  transform: translate(-50%, 0);\n  border-radius: 10px;\n  padding: 20px;\n  display: flex;\n  background-color: #fff;\n  z-index: 400;\n}\n@media screen and (max-width: 768px) {\n.message_detail .message__input_form[data-v-9d337cf6] {\n    width: 90vw;\n    border-radius: 2vw;\n    padding: 4vw;\n}\n}\n.message_detail .message__input_form textarea[data-v-9d337cf6] {\n  flex: 1;\n  border-radius: 5px;\n  border: 1px solid #777;\n  padding: 6px;\n}\n@media screen and (max-width: 768px) {\n.message_detail .message__input_form textarea[data-v-9d337cf6] {\n    border-radius: 1vw;\n    padding: 1vw;\n}\n}\n.message_detail .message__input_form button[data-v-9d337cf6] {\n  margin-left: 10px;\n  padding-left: 10px;\n  padding-right: 10px;\n  height: 30px;\n  border-radius: 4px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  border: 0;\n  background-color: var(--main-color);\n}\n@media screen and (max-width: 768px) {\n.message_detail .message__input_form button[data-v-9d337cf6] {\n    margin-left: 2vw;\n    padding-left: 2vw;\n    padding-right: 2vw;\n    height: 8vw;\n    border-radius: 1vw;\n}\n}\n.attension[data-v-9d337cf6] {\n  color: #ff0000;\n  margin-bottom: 10px;\n}",""])},69:function(e,t,n){"use strict";n.r(t);var a=n(1),s=n.n(a);function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function d(e,t,n,a,s,r,i){try{var o=e[r](i),d=o.value}catch(e){return void n(e)}o.done?t(d):Promise.resolve(d).then(a,s)}function c(e){return function(){var t=this,n=arguments;return new Promise((function(a,s){var r=e.apply(t,n);function i(e){d(r,a,s,i,o,"next",e)}function o(e){d(r,a,s,i,o,"throw",e)}i(void 0)}))}}var m={components:{BottomTab:n(18).a},data:function(){return{messages:[],chatroom_detail:null,content:"",unsubscribe:void 0}},mounted:function(){this.init()},methods:{init:function(){var e=this;return c(s.a.mark((function t(){var n,a;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,axios.post("/api/get_message_list",{id:e.$route.query.id});case 3:n=t.sent,a=n.data,e.messages=a.messages.map((function(t){return i(i({},t),{},{self:t.sender_id==e.$store.getters["auth/user"].id})})),setTimeout((function(){e.animateScroll(400,document.getElementById("message_list"))}),10),e.chatroom_detail=a.chatroom_info,1==e.$store.getters["auth/user"].role&&1==e.checkMessage()&&(e.content="初めまして！よろしくお願いします！"),e.subscribe(),t.next=14;break;case 12:t.prev=12,t.t0=t.catch(0);case 14:case"end":return t.stop()}}),t,null,[[0,12]])})))()},toProfileDetail:function(e){this.$router.push({name:"user.detail",query:{id:e}})},animateScroll:function(e,t){var n=t.scrollTop,a=t.scrollHeight-n;!function s(r){var i=function(e,t,n,a){return(e/=a/2)<1?n/2*e*e+t:-n/2*((e-=1)*(e-2)-1)+t}(r+=20,n,a,e);t.scrollTop=i,r<e&&setTimeout((function(){s(r)}),20)}(0)},checkMessage:function(){var e=this,t=this.messages,n=1;t.filter((function(t){return t.sender_id==e.$store.getters["auth/user"].id})).length>=1?n=2:t.filter((function(t){return t.sender_id!=e.$store.getters["auth/user"].id})).length>=1&&(n=3);return n},subscribe:function(){var e=this;this.unsubscribe=db.collection("messages").doc(this.chatroom_detail.firebaseKey).onSnapshot((function(t){var n=t.data();if(n){var a=e.messages.filter((function(e){return e.id==n.id}));n.sender_id!=e.$store.getters["auth/user"].id&&0==a.length&&(e.messages.push(i(i({},n),{},{self:n.sender_id==e.$store.getters["auth/user"].id})),e.readFlag(),setTimeout((function(){e.animateScroll(400,document.getElementById("message_list"))}),1e3))}}))},readFlag:function(){var e=this;return c(s.a.mark((function t(){var n;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,axios.post("/api/get_message_list",{id:e.$route.query.id});case 2:n=t.sent,n.data;case 4:case"end":return t.stop()}}),t)})))()},showMask:function(e){if(1==this.$store.getters["auth/user"].role){var t=this.messages.filter((function(e){return 1==e.self})),n=this.messages.filter((function(e){return 0==e.self}));return!(t.length>0&&e.id==t[0].id)&&!(n.length>0&&e.id==n[0].id)}return!1},sendMessage:function(){var e=this;return c(s.a.mark((function t(){var n,a;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e.messages.length>0&&1==e.$store.getters["auth/user"].role)){t.next=4;break}return e.$swal("","２回目のメッセージを送信するには有料会員へのアップグレードが必要です。"),e.$router.push({name:"mypage.plan_upgrade"}),t.abrupt("return");case 4:if(""!=e.content.trim()){t.next=6;break}return t.abrupt("return");case 6:if(1!=e.$store.getters["auth/user"].role){t.next=12;break}if(!(e.messages.filter((function(e){return 1==e.self})).length>0)){t.next=12;break}return e.$swal("","２回目のメッセージを送信するには有料会員へのアップグレードが必要です。"),e.$router.push({name:"mypage.plan_upgrade"}),t.abrupt("return");case 12:return t.next=14,axios.post("/api/send_message",{content:e.content,chatroom_id:e.$route.query.id,read_flags:String(e.$store.getters["auth/user"].id)});case 14:return n=t.sent,a=n.data,e.messages.push(i(i({},a.message),{},{self:!0})),setTimeout((function(){e.animateScroll(400,document.getElementById("message_list"))}),1e3),t.next=20,db.collection("messages").doc(e.chatroom_detail.firebaseKey).set(i({},a.message));case 20:e.content="";case 21:case"end":return t.stop()}}),t)})))()}},beforeDestroy:function(){this.unsubscribe&&this.unsubscribe()}},l=(n(381),n(4)),u=Object(l.a)(m,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"message_detail"},[1==e.$store.getters["auth/user"].role?n("p",{staticClass:"attension"},[e._v("\n    無料会員は定型メッセージのみ送付可能です。通常のメッセージを送りたい方は有料会員登録をお願いします。また２通目以降のメッセージの確認に関しても有料会員登録が必要です。\n  ")]):e._e(),e._v(" "),e.messages.length>0?n("div",{staticClass:"message_list",attrs:{id:"message_list"}},e._l(e.messages,(function(t,a){return n("div",{key:a,staticClass:"message__item"},[0==t.self?n("p",{staticClass:"avatar",on:{click:function(n){return e.toProfileDetail(t.user.id)}}},[n("img",{attrs:{src:t.user.avatars[0].avatar_url}}),e._v(" "),n("span",{staticClass:"name"},[e._v(e._s(t.user.profile.nickname))])]):e._e(),e._v(" "),n("div",{staticClass:"message_body"},[n("p",{staticClass:"date",class:{self:1==t.self}},[e._v(e._s(e._f("productUpTimeFormat")(t.created_at)))]),e._v(" "),n("p",{staticClass:"content",class:{self:1==t.self}},[e._v(e._s(t.content)),e.showMask(t)?n("span",{staticClass:"mask"}):e._e()])]),e._v(" "),1==t.self?n("p",{staticClass:"avatar avatar1"},[n("img",{attrs:{src:t.user.avatars[0].avatar_url}}),e._v(" "),n("span",{staticClass:"name"},[e._v(e._s(t.user.profile.nickname))])]):e._e()])})),0):e._e(),e._v(" "),n("div",{staticClass:"message__input_form"},[n("textarea-autosize",{ref:"myTextarea",attrs:{placeholder:"メッセージ","min-height":40,"max-height":140,disabled:1==e.$store.getters["auth/user"].role},model:{value:e.content,callback:function(t){e.content=t},expression:"content"}}),e._v(" "),n("button",{on:{click:e.sendMessage}},[e._v("送信する")])],1),e._v(" "),n("BottomTab")],1)}),[],!1,null,"9d337cf6",null);t.default=u.exports}}]);